<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Operating Forms â€” Abnormal Working</title>

<style>
  :root{
    --header-h:120px;
    --accent-blue:#1976d2;
    --accent-green:#388e3c;
    --bg:#f6f8fb;
    --card:#ffffff;
    --muted:#6b7280;
    --max-width:980px;
    --pill-min:260px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:#071133;-webkit-font-smoothing:antialiased;overflow-x:hidden}

  /* Header */
  header{
    position:sticky; top:0; z-index:1100;
    min-height:var(--header-h);
    display:flex; align-items:center; justify-content:center;
    background:linear-gradient(90deg,var(--accent-blue),var(--accent-green));
    color:#fff; padding:12px; box-shadow:0 6px 18px rgba(6,20,52,0.12);
  }
  #mainHeading{
    margin:0; font-size:clamp(1.4rem,3.6vw,2.4rem); font-weight:800; letter-spacing:.4px; text-align:center; padding:0 84px;
    line-height:1.05;
    word-break:break-word;
  }

  /* header buttons (left / right) */
  .btn-circle{
    position:absolute; bottom:14px; width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; border:0;
    cursor:pointer; box-shadow:0 6px 18px rgba(6,20,52,0.18); background:rgba(0,0,0,0.12);
  }
  .btn-back{ left:12px }
  .btn-menu{ right:12px }
  .btn-circle svg{ width:20px; height:20px; stroke:#fff; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round }

/* Sticky system subheading - fully centered & mobile friendly */
#systemSticky {
  position: sticky;
  top: calc(var(--header-h) - 4px);
  z-index: 1099;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px 0;
  background: transparent;
  text-align: center;
}

#systemLabel {
  display: inline-block;
  padding: 10px 22px;
  border-radius: 999px;
  font-weight: 900;
  font-size: 1.05rem;
  color: #fff;
  box-shadow: 0 10px 30px rgba(3, 10, 36, 0.12);
  text-align: center;
  min-width: 220px;
  margin: auto;
}

  /* main layout */
  main{ max-width:var(--max-width); margin:18px auto; padding:12px; width:100% }

  .card-surface{ background:transparent; border-radius:14px; padding:6px; }

  /* Home pills */
  .pill-row{ display:flex; gap:18px; justify-content:center; margin-top:12px; flex-wrap:wrap; }
  .pill{
    min-width:var(--pill-min); max-width:100%; padding:20px 28px; border-radius:999px; font-weight:900; color:#fff; border:0; font-size:1.05rem;
    cursor:pointer; text-align:center; box-shadow:0 18px 40px rgba(3,10,36,0.08); transition:transform .16s ease;
  }
  .pill.abs{ background: linear-gradient(180deg,#1e7ad9,#0f63b8) }
  .pill.ats{ background: linear-gradient(180deg,#3fa04a,#2e8a3a) }
  .pill:active{ transform:translateY(1px) }

  /* grid of authority tiles */
  .grid{ margin-top:18px; display:grid; gap:16px; grid-template-columns:repeat(1,1fr) }
  @media(min-width:560px){ .grid{ grid-template-columns:repeat(2,1fr) } }
  @media(min-width:980px){ .grid{ grid-template-columns:repeat(3,1fr) } }

  .tile{
    display:flex; flex-direction:column; gap:10px; padding:18px; border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,252,0.98));
    border:1px solid rgba(14,20,30,0.03);
    box-shadow: 0 18px 40px rgba(18,28,46,0.06);
    text-align:center; transition:transform .18s cubic-bezier(.2,.9,.2,1), box-shadow .18s ease;
  }
  .tile:hover{ transform:translateY(-8px); box-shadow: 0 34px 70px rgba(18,28,46,0.12) }

  .auth-id{ font-weight:900; font-size:1.12rem; color:#071133 }
  .auth-desc{ color:var(--muted); font-size:0.95rem; line-height:1.35; min-height:2.6em }

  .tile-actions{ display:flex; justify-content:center; margin-top:6px }
  .btn-view{
    padding:12px 22px; border-radius:999px; border:0; cursor:pointer; font-weight:900; color:#fff;
    min-width:140px; box-shadow: 0 12px 36px rgba(15,74,163,0.14);
    background:linear-gradient(90deg,var(--accent-blue),#0f63b8);
  }
  .tile.ats .btn-view{ background:linear-gradient(90deg,var(--accent-green),#2e8a3a); box-shadow: 0 12px 36px rgba(46,132,50,0.12) }

  /* empty note */
  .empty-note{ padding:20px; text-align:center; color:var(--muted) }

  /* side menu (right side, off-canvas) */
  #overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.35); display:none; z-index:2000 }
  #sideMenu{
    position:fixed; top:0; right:0; width:320px; height:100vh; background:#fff; box-shadow:-12px 0 40px rgba(6,20,52,0.12);
    transform:translateX(100%); transition:transform .28s ease; z-index:2001; padding:18px; overflow:auto;
  }
  #sideMenu.open{ transform:translateX(0) }
  .menu-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px }
  .menu-list a, .menu-list button{ display:block; padding:12px; border-radius:10px; text-decoration:none; color:#071133; background:transparent; border:0; text-align:left; cursor:pointer }
  .menu-sub{ padding-left:8px; display:flex; flex-direction:column; gap:6px; margin-top:6px }

  @media(max-width:520px){
    .pill{ min-width:92% }
    .btn-view{ min-width:140px }
    .auth-id{ font-size:1.05rem }
    #sideMenu{ width:88vw }
  }
  .menu-forms {
  list-style: none;
  padding-left: 16px;
  margin: 6px 0;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.menu-forms li {
  background: #f3f6fa;
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background .2s;
}
.menu-forms li:hover {
  background: #e8eef5;
}
  .menu-forms {
  display: none;
  flex-direction: column;
  gap: 6px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 260ms ease;
}
.menu-forms.open {
  display: flex;
  max-height: 800px; /* large enough for content */
}
</style>
</head>
<body>

  <header>
    <h1 id="mainHeading">Operating Forms</h1>

    <button class="btn-circle btn-back" id="btnBack" aria-label="Back">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 12H5M12 5l-7 7 7 7" /></svg>
    </button>

    <button class="btn-circle btn-menu" id="btnMenu" aria-label="Open menu">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z" /></svg>
    </button>
  </header>

  <!-- sticky system label area (appears after selecting a system) -->
  <div id="systemSticky" aria-hidden="true">
    <div id="systemLabel" role="status" aria-live="polite" style="display:none"></div>
  </div>

  <main class="app" role="main">
    <div class="card-surface">

      <!-- Home: pill system selection -->
      <div id="homeArea">
        <div class="pill-row">
          <button class="pill abs" id="pillABS" data-system="Absolute Block System">Absolute Block System</button>
          <button class="pill ats" id="pillATS" data-system="Automatic Block Section">Automatic Block Section</button>
        </div>
      </div>

      <!-- Forms list area -->
      <div id="formsArea" style="display:none">
        <div id="formsGrid" class="grid" role="list"></div>
        <div id="noForms" class="empty-note" style="display:none">No forms available for this system.</div>
      </div>

    </div>
  </main>

  <div id="overlay" aria-hidden="true"></div>

  <!-- side menu -->
<aside id="sideMenu" aria-hidden="true">

  <ul class="menu-list">
    <li><b></b><a href="index.html">Home</a></b></li>

    <li>
      <div style="font-weight:800;padding:8px 6px">Operating Forms</div>
      <div class="menu-sub">
        <button class="menu-system" data-system="Absolute Block System">Absolute Block System</button>
        <ul id="menuFormsABS" class="menu-forms" style="display:none"></ul>

        <button class="menu-system" data-system="Automatic Block Section">Automatic Block Section</button>
        <ul id="menuFormsATS" class="menu-forms" style="display:none"></ul>
      </div>
    </li>
  </ul>
</aside>

<script>
  /************************************************************************
   * DATA
   * Replace the file paths with the correct paths to your hosted PDFs / images.
   * If hosting via GitHub Pages in the same repo, relative 'forms/t369.pdf' works.
   * If using raw.githubusercontent.com, set the raw absolute URLs.
   ************************************************************************/
  const DATA = {
    "Absolute Block System": [
      { id: 'T/369(3b)', desc: 'Private number authority used for double line failures.', file: 'forms/t369.png' },
      { id: 'T/806',     desc: 'Shunting movement authority & endorsements.', file: 'forms/t806.pdf' },
      { id: 'T/510',     desc: 'Used for piloting trains into stations safely.', file: 'forms/t510.pdf' }
    ],
    "Automatic Block Section": [
      { id: 'T/C 1425', desc: 'Block instrument authority for signal failures.', file: 'forms/tc1425.pdf' },
      { id: 'T/D 912',  desc: 'Authority for prolonged failure of signals.', file: 'forms/td912.pdf' }
    ]
  };

  // UI refs
  const pillABS = document.getElementById('pillABS');
  const pillATS = document.getElementById('pillATS');
  const homeArea = document.getElementById('homeArea');
  const formsArea = document.getElementById('formsArea');
  const formsGrid = document.getElementById('formsGrid');
  const noForms = document.getElementById('noForms');
  const systemSticky = document.getElementById('systemSticky');
  const systemLabel = document.getElementById('systemLabel');
  const btnBack = document.getElementById('btnBack');
  const btnMenu = document.getElementById('btnMenu');
  const sideMenu = document.getElementById('sideMenu');
  const overlay = document.getElementById('overlay');

  let currentSystem = null;

  // Navigation to the viewer: relative viewer.html in same repo
  const VIEWER_PATH = 'viewer.html'; // change if viewer hosted elsewhere

  // Render tiles for a system
  function renderGrid(system){
    formsGrid.innerHTML = '';
    const list = DATA[system] || [];
    if (!list.length){
      noForms.style.display = 'block';
      formsGrid.style.display = 'none';
      return;
    }
    noForms.style.display = 'none';
    formsGrid.style.display = 'grid';

    list.forEach(item => {
      const tile = document.createElement('article');
      tile.className = 'tile' + (system.includes('Automatic') ? ' ats' : '');
      tile.setAttribute('role','listitem');

      const idEl = document.createElement('div');
      idEl.className = 'auth-id';
      idEl.textContent = item.id;

      const descEl = document.createElement('div');
      descEl.className = 'auth-desc';
      descEl.textContent = item.desc || '';

      const actions = document.createElement('div');
      actions.className = 'tile-actions';
      const btn = document.createElement('button');
      btn.className = 'btn-view';
      btn.textContent = 'View';
      btn.addEventListener('click', ()=> openViewer(item));

      actions.appendChild(btn);
      tile.appendChild(idEl);
      tile.appendChild(descEl);
      tile.appendChild(actions);

      formsGrid.appendChild(tile);
    });
  }

  // Select a system (called from pills and menu)
  function selectSystem(system){
    currentSystem = system;
    systemLabel.textContent = system;
    systemLabel.style.display = 'inline-block';
    // color the sticky label to reflect system
    if (system.includes('Automatic')){
      systemLabel.style.background = 'linear-gradient(90deg,var(--accent-green),#2e8a3a)';
    } else {
      systemLabel.style.background = 'linear-gradient(90deg,var(--accent-blue),#0f63b8)';
    }
    systemSticky.style.display = 'block';
    homeArea.style.display = 'none';
    formsArea.style.display = 'block';
    renderGrid(system);
    // update URL for bookmarking (optional)
    try { history.pushState({screen:'forms', system}, '', '?system=' + encodeURIComponent(system)); } catch(e){}
  }

  // Open viewer in same origin viewer.html with params
  function openViewer(item){
    // Build query string for viewer.html
    const q = new URLSearchParams();
    q.set('file', item.file);
    q.set('system', currentSystem || '');
    q.set('id', item.id);
    // Navigate to viewer (in same tab)
    window.location.href = VIEWER_PATH + '?' + q.toString();
  }

  // Back button behaviour: if in forms list go to home of operating forms, else go back to index
  btnBack.addEventListener('click', (e) => {
    e.preventDefault();
    if (formsArea.style.display !== 'none'){
      // go back to home pills
      formsArea.style.display = 'none';
      homeArea.style.display = 'block';
      systemSticky.style.display = 'none';
      currentSystem = null;
      try { history.pushState({}, '', location.pathname); } catch(e){}
      return;
    }
    // otherwise go to main app
    window.location.href = 'index.html';
  });

  // Menu toggle
  btnMenu.addEventListener('click', ()=>{
    const opening = !sideMenu.classList.contains('open');
    if (opening){
      sideMenu.classList.add('open'); overlay.style.display = 'block'; sideMenu.setAttribute('aria-hidden','false');
    } else {
      sideMenu.classList.remove('open'); overlay.style.display = 'none'; sideMenu.setAttribute('aria-hidden','true');
    }
  });
  overlay.addEventListener('click', ()=>{ sideMenu.classList.remove('open'); overlay.style.display = 'none'; sideMenu.setAttribute('aria-hidden','true'); });

  // menu system buttons
  document.querySelectorAll('.menu-system').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const sys = btn.dataset.system;
      sideMenu.classList.remove('open'); overlay.style.display = 'none'; sideMenu.setAttribute('aria-hidden','true');
      // small delay so menu closes smoothly
      setTimeout(()=> selectSystem(sys), 120);
    });
  });

  // pill clicks
  [pillABS, pillATS].forEach(p => p.addEventListener('click', (e)=> selectSystem(p.dataset.system)));

  // initialize from querystring (optional)
  (function initFromQuery(){
    const q = new URLSearchParams(location.search);
    const sys = q.get('system'), id = q.get('id');
    if (sys && DATA[sys]){
      selectSystem(sys);
      if (id){
        const arr = DATA[sys] || [];
        const item = arr.find(x => x.id === id);
        if (item){
          // open viewer if doc provided
          setTimeout(()=> openViewer(item), 250);
        }
      }
    }
  })();

  // Populate side menu forms dynamically
function populateMenuForms() {
  const absList = document.getElementById('menuFormsABS');
  const atsList = document.getElementById('menuFormsATS');

  // ensure lists exist
  if (!absList || !atsList) return;

  absList.innerHTML = '';
  atsList.innerHTML = '';

  (DATA['Absolute Block System'] || []).forEach(f => {
    const li = document.createElement('li');
    li.style.listStyle = 'none';
    // Use a button for accessibility and to avoid accidental navigation
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'menu-form';
    btn.textContent = f.id;
    btn.style.width = '100%';
    btn.style.textAlign = 'left';
    btn.style.padding = '8px 10px';
    btn.style.border = '0';
    btn.style.background = 'transparent';
    btn.style.cursor = 'pointer';

    btn.addEventListener('click', (e) => {
      e.stopPropagation(); // prevent bubbling to parent handlers
      openViewer(f);
      // close side menu after opening (optional; remove if you want menu to stay open)
      sideMenu.classList.remove('open');
      overlay.style.display = 'none';
    });

    li.appendChild(btn);
    absList.appendChild(li);
  });

  (DATA['Automatic Block Section'] || []).forEach(f => {
    const li = document.createElement('li');
    li.style.listStyle = 'none';
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'menu-form';
    btn.textContent = f.id;
    btn.style.width = '100%';
    btn.style.textAlign = 'left';
    btn.style.padding = '8px 10px';
    btn.style.border = '0';
    btn.style.background = 'transparent';
    btn.style.cursor = 'pointer';

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      openViewer(f);
      sideMenu.classList.remove('open');
      overlay.style.display = 'none';
    });

    li.appendChild(btn);
    atsList.appendChild(li);
  });
}

// Toggle expand/collapse for systems inside side menu
document.querySelectorAll('.menu-system').forEach(btn => {
  const sysName = btn.dataset.system;
  const listId = sysName.includes('Absolute') ? 'menuFormsABS' : 'menuFormsATS';
  const listEl = document.getElementById(listId);

  // initialise hidden
  if (listEl) listEl.style.display = 'none';
  btn.setAttribute('aria-expanded', 'false');

  btn.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation(); // important: prevents other handlers from closing menu

    if (!listEl) return;
    const isHidden = listEl.style.display === '' || listEl.style.display === 'none';
    // Toggle clicked list
    listEl.style.display = isHidden ? 'flex' : 'none';
    listEl.style.flexDirection = 'column';
    btn.setAttribute('aria-expanded', String(isHidden));

    // Collapse the other list so only one is open
    const otherListId = listId === 'menuFormsABS' ? 'menuFormsATS' : 'menuFormsABS';
    const otherList = document.getElementById(otherListId);
    const otherBtn = Array.from(document.querySelectorAll('.menu-system'))
      .find(b => (b.dataset.system.includes('Absolute') ? 'menuFormsABS' : 'menuFormsATS') === otherListId);
    if (otherList && otherList !== listEl) {
      otherList.style.display = 'none';
      if (otherBtn) otherBtn.setAttribute('aria-expanded', 'false');
    }
  });
});

/* finally populate lists */
populateMenuForms();

</script>

</body>
</html>
