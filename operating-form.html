<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Operating Forms — Abnormal Working Style</title>
  <style>
    :root{
      --header-height:120px;
      --accent-blue:#1976d2;
      --accent-green:#388e3c;
      --bg:#f6f8fb;
      --card:#ffffff;
      --muted:#6b7280;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial; background:linear-gradient(180deg,#f8fafc 0%,var(--bg) 100%); color:#0b1220; overflow-x:hidden}

    /* Header */
    header{
      position:sticky; top:0; z-index:120; min-height:var(--header-height);
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(90deg,var(--accent-blue),var(--accent-green));
      color:#fff; padding:12px; box-shadow:0 6px 18px rgba(6,20,52,0.12);
    }
    #mainHeading{ margin:0; font-size:clamp(1.6rem,4vw,2.2rem); font-weight:800; letter-spacing:.4px; text-align:center; padding:0 68px; }

    .btn-circle{ position:absolute; bottom:14px; width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; border:0; cursor:pointer; box-shadow:0 6px 18px rgba(6,20,52,0.18); transition:transform .14s ease }
    .back-btn{ left:12px; background:rgba(0,0,0,0.12) }
    .menu-btn{ right:12px; background:rgba(0,0,0,0.12) }
    .btn-circle svg{ width:20px; height:20px; stroke:#fff; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round }
    .btn-circle:hover{ transform:translateY(-3px) }

    /* sticky system label below header */
    #systemSub{ display:none; position:sticky; top:calc(var(--header-height) - 6px); z-index:110; background:transparent; padding:10px; text-align:center; }
    #systemLabel{ display:inline-block; padding:10px 18px; border-radius:999px; font-weight:800; color:#fff; box-shadow:0 10px 28px rgba(3,10,36,0.12); min-width:200px; }

    main.app{ max-width:980px; margin:18px auto; padding:12px; width:100% }
    .card-surface{ background:transparent; border-radius:14px; padding:12px; }

    /* Home pills */
    .pill-row{ display:flex; gap:18px; justify-content:center; margin-top:16px; flex-wrap:wrap; }
    .pill{
      min-width:320px; max-width:100%; padding:22px 36px; border-radius:999px; font-weight:900; color:#fff; border:0;
      font-size:1.15rem; cursor:pointer; text-align:center; box-shadow:0 18px 40px rgba(3,10,36,0.08); transition:transform .16s ease;
    }
    .pill.abs{ background: linear-gradient(180deg,#1e7ad9,#0f63b8) }
    .pill.ats{ background: linear-gradient(180deg,#3fa04a,#2e8a3a) }
    .pill:active{ transform:translateY(1px) }

    .grid{ margin-top:20px; display:grid; gap:16px; grid-template-columns:repeat(1,1fr) }
    @media(min-width:560px){ .grid{ grid-template-columns:repeat(2,1fr) } }
    @media(min-width:980px){ .grid{ grid-template-columns:repeat(3,1fr) } }

    /* Card layout */
    .tile{
      display:flex; flex-direction:column; gap:12px; padding:18px; border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(250,250,252,0.97));
      border:1px solid rgba(14,20,30,0.03);
      box-shadow: 0 18px 40px rgba(18,28,46,0.06);
      text-align:center;
      transition:transform .18s cubic-bezier(.2,.9,.2,1), box-shadow .18s ease;
    }
    .tile:hover{ transform:translateY(-8px); box-shadow: 0 34px 70px rgba(18,28,46,0.12) }

    .auth-number{ font-weight:900; font-size:1.15rem; color:#071133 }
    .auth-desc{ color:var(--muted); font-size:0.95rem; line-height:1.35; min-height:2.6em }

    .tile-actions{ display:flex; justify-content:center; align-items:center; margin-top:6px }
    .btn-view{
      padding:12px 22px; border-radius:999px; border:0; cursor:pointer; font-weight:900; color:#fff;
      box-shadow: 0 12px 36px rgba(15,74,163,0.14); min-width:160px;
      background:linear-gradient(90deg,var(--accent-blue),#0f63b8);
    }
    .tile.ats .btn-view{ background:linear-gradient(90deg,var(--accent-green),#2e8a3a); box-shadow:0 12px 36px rgba(46,132,50,0.12) }

    .empty-note{ display:none }

    /* side menu (right) */
    #overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.35); display:none; z-index:998 }
    #sideMenu{ position:fixed; top:0; right:0; width:340px; height:100vh; background:#fff; box-shadow:-12px 0 40px rgba(6,20,52,0.12); transform:translateX(100%); transition:transform .28s ease; z-index:999; padding:18px; overflow:auto }
    #sideMenu.open{ transform:translateX(0) }

    .menu-header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px }
    .menu-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px }
    .menu-section{ border-radius:10px; padding:8px; background:#fbfdff; border:1px solid rgba(12,18,36,0.03) }
    .menu-system{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px; width:100%; text-align:left; border:0; background:transparent; cursor:pointer; font-weight:800 }
    .menu-system:focus{ outline:2px solid rgba(25,118,210,0.12) }

    .menu-forms{ display:none; flex-direction:column; gap:6px; margin-top:6px; padding-left:6px; }
    .menu-forms button{ text-align:left; padding:8px 10px; border-radius:8px; border:0; background:transparent; cursor:pointer; font-weight:700 }
    .menu-forms button:hover{ background:rgba(6,20,52,0.03) }

    .close-menu{ border:0; background:transparent; cursor:pointer; font-weight:700; color:var(--muted) }

    @media(max-width:520px){
      .pill{ min-width:92% }
      .btn-view{ min-width:140px }
      .auth-number{ font-size:1.05rem }
      #sideMenu{ width:92%; }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="mainHeading">Operating Forms</h1>

    <button class="btn-circle back-btn" id="headerBack" aria-label="Back">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 12H5M12 5l-7 7 7 7" /></svg>
    </button>

    <button class="btn-circle menu-btn" id="openMenu" aria-label="Open menu">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z" /></svg>
    </button>
  </header>

  <div id="systemSub" aria-hidden="true">
    <div id="systemLabel" role="status" aria-live="polite"></div>
  </div>

  <main class="app" role="main">
    <div class="card-surface">
      <!-- Home Pills -->
      <div id="homePills">
        <div class="pill-row">
          <button class="pill abs" id="pillABS" data-system="Absolute Block System">Absolute Block System</button>
          <button class="pill ats" id="pillATS" data-system="Automatic Block Section">Automatic Block Section</button>
        </div>
      </div>

      <!-- Forms area -->
      <div id="formsArea" style="display:none">
        <div id="formsGrid" class="grid" role="list"></div>
      </div>
    </div>
  </main>

  <div id="overlay" aria-hidden="true"></div>

  <aside id="sideMenu" aria-hidden="true">
    <div class="menu-header">
      <div style="font-weight:900">Menu</div>
      <button id="closeSide" class="close-menu" aria-label="Close menu">Close</button>
    </div>

    <ul class="menu-list" role="menu" aria-label="App menu">
      <li class="menu-section">
        <a href="index.html" style="display:block;padding:8px 6px;text-decoration:none;color:#071133;font-weight:800">Home</a>
      </li>

      <li class="menu-section" aria-expanded="false">
        <button class="menu-system" type="button" data-system="Absolute Block System">Operating Forms — Absolute Block System
          <span aria-hidden="true">▸</span>
        </button>
        <div id="menuFormsABS" class="menu-forms" role="menu"></div>
      </li>

      <li class="menu-section" aria-expanded="false">
        <button class="menu-system" type="button" data-system="Automatic Block Section">Operating Forms — Automatic Block Section
          <span aria-hidden="true">▸</span>
        </button>
        <div id="menuFormsATS" class="menu-forms" role="menu"></div>
      </li>
    </ul>
  </aside>

<script>
  /* ---------- DATA (adjust file paths as needed) ---------- */
  const DATA = {
    "Absolute Block System": [
      { id: 'T/369(3b)', title:'Private Number / T/369', desc:'Use when double line signal failure — private number authority.', file:'forms/t369.pdf' },
      { id: 'T/806', title:'Shunting Form T/806', desc:'Shunting authority and endorsement procedures.', file:'forms/t806.pdf' },
      { id: 'T/510', title:'Pilot In Memo / T/510', desc:'Used for piloting trains into stations.', file:'forms/t510.pdf' }
    ],
    "Automatic Block Section": [
      { id: 'T/C 1425', title:'PLCT / T/C 1425', desc:'Block instrument authority for failed signals on single line.', file:'forms/tc1425.pdf' },
      { id: 'T/D 912', title:'Prolonged Failure / T/D 912', desc:'Authority for prolonged failure of signals.', file:'forms/td912.pdf' }
    ]
  };

  /* ---------- UI refs ---------- */
  const pillABS = document.getElementById('pillABS');
  const pillATS = document.getElementById('pillATS');
  const homePills = document.getElementById('homePills');
  const formsArea = document.getElementById('formsArea');
  const formsGrid = document.getElementById('formsGrid');
  const systemSub = document.getElementById('systemSub');
  const systemLabel = document.getElementById('systemLabel');
  const headerBack = document.getElementById('headerBack');
  const openMenuBtn = document.getElementById('openMenu');
  const sideMenu = document.getElementById('sideMenu');
  const overlay = document.getElementById('overlay');
  const closeSide = document.getElementById('closeSide');

  let currentSystem = null;

  /* ---------- Main list rendering ---------- */
  function renderGrid(system){
    formsGrid.innerHTML = '';
    const arr = DATA[system] || [];
    if (!arr.length) {
      formsGrid.innerHTML = '<div style="grid-column:1/-1;color:var(--muted)">No forms available</div>';
      return;
    }
    arr.forEach(it => {
      const tile = document.createElement('article');
      tile.className = 'tile' + (system.includes('Automatic') ? ' ats' : '');
      tile.setAttribute('role','listitem');

      const auth = document.createElement('div'); auth.className = 'auth-number'; auth.textContent = it.id;
      const d = document.createElement('div'); d.className = 'auth-desc'; d.textContent = it.desc || '';
      const actions = document.createElement('div'); actions.className = 'tile-actions';
      const btn = document.createElement('button'); btn.className = 'btn-view'; btn.textContent = 'View';
      btn.addEventListener('click', ()=> openViewer(it));
      actions.appendChild(btn);

      tile.appendChild(auth); tile.appendChild(d); tile.appendChild(actions);
      formsGrid.appendChild(tile);
    });
  }

  function selectSystem(system){
    currentSystem = system;
    systemLabel.textContent = system;
    systemLabel.style.background = system.includes('Automatic') ? 'linear-gradient(90deg,var(--accent-green),#2e8a3a)' : 'linear-gradient(90deg,var(--accent-blue),#0f63b8)';
    systemSub.style.display = 'block';
    renderGrid(system);
    homePills.style.display = 'none';
    formsArea.style.display = 'block';
    try { history.pushState({page:'list', system}, '', '?system=' + encodeURIComponent(system)); } catch(e){}
  }

  [pillABS, pillATS].forEach(b => b.addEventListener('click', ()=> selectSystem(b.dataset.system)));

  headerBack.addEventListener('click', ()=>{
    if (formsArea.style.display !== 'none'){ formsArea.style.display='none'; homePills.style.display='block'; systemSub.style.display='none'; currentSystem = null; return; }
    window.location.href = 'index.html';
  });

  /* ---------- Viewer navigation: open viewer.html with params ---------- */
  function openViewer(item){
    const q = new URLSearchParams();
    q.set('file', item.file);
    q.set('id', item.id);
    q.set('system', currentSystem || '');
    // close the side menu if open
    sideMenu.classList.remove('open');
    overlay.style.display = 'none';
    // navigate to your viewer.html (which you uploaded)
    window.location.href = 'viewer.html?' + q.toString();
  }

  /* ---------- Side-menu population & toggles ---------- */
  function populateMenuForms() {
    const absList = document.getElementById('menuFormsABS');
    const atsList = document.getElementById('menuFormsATS');
    if (!absList || !atsList) return;
    absList.innerHTML = '';
    atsList.innerHTML = '';

    (DATA['Absolute Block System'] || []).forEach(f => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'menu-form';
      btn.textContent = f.id;
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        // set currentSystem so viewer receives context
        currentSystem = 'Absolute Block System';
        openViewer(f);
      });
      absList.appendChild(btn);
    });

    (DATA['Automatic Block Section'] || []).forEach(f => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'menu-form';
      btn.textContent = f.id;
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        currentSystem = 'Automatic Block Section';
        openViewer(f);
      });
      atsList.appendChild(btn);
    });

    absList.style.display = 'none';
    atsList.style.display = 'none';
  }

  function wireSystemToggles() {
    document.querySelectorAll('.menu-system').forEach(btn => {
      if (btn.__wired) return;
      btn.__wired = true;
      const sys = btn.dataset.system || '';
      const listId = sys.includes('Absolute') ? 'menuFormsABS' : 'menuFormsATS';
      const listEl = document.getElementById(listId);
      if (!listEl) return;
      btn.setAttribute('aria-expanded', 'false');
      listEl.style.display = 'none';
      btn.addEventListener('click', (e) => {
        e.preventDefault(); e.stopPropagation();
        const isOpen = listEl.style.display !== 'none';
        // close other
        ['menuFormsABS','menuFormsATS'].forEach(id => {
          if (id === listId) return;
          const other = document.getElementById(id);
          if (other) other.style.display = 'none';
        });
        listEl.style.display = isOpen ? 'none' : 'flex';
        listEl.style.flexDirection = 'column';
        btn.setAttribute('aria-expanded', String(!isOpen));
      });
    });
  }

  function wireMenuOpenClose() {
    if (openMenuBtn && !openMenuBtn.__wired) {
      openMenuBtn.__wired = true;
      openMenuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = sideMenu.classList.toggle('open');
        overlay.style.display = isOpen ? 'block' : 'none';
      });
    }
    closeSide.addEventListener('click', () => { sideMenu.classList.remove('open'); overlay.style.display = 'none'; });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!sideMenu.classList.contains('open')) return;
      if (sideMenu.contains(e.target) || (openMenuBtn && openMenuBtn.contains(e.target))) return;
      sideMenu.classList.remove('open'); overlay.style.display = 'none';
    }, true);

    // Escape closes
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && sideMenu.classList.contains('open')) {
        sideMenu.classList.remove('open'); overlay.style.display = 'none';
      }
    });

    overlay.addEventListener('click', () => { sideMenu.classList.remove('open'); overlay.style.display = 'none'; });
  }

  /* ---------- Init ---------- */
  populateMenuForms();
  wireSystemToggles();
  wireMenuOpenClose();

  // Restore state from URL if needed
  (function initFromQuery(){
    const q = new URLSearchParams(location.search);
    const sys = q.get('system');
    if (sys && DATA[sys]) { selectSystem(sys); }
  })();

</script>
</body>
</html>
